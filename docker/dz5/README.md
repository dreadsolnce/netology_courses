# Описание проекта

С помощью terraform разворачивается инфраструктура в yandex облаке, с помощью ansible выполняется копирование приложения на
развёрнутую инфраструктуру в облаке, и так же с помощью ansible выполняется деплой приложения в кластере docker swarm. Весь 
процесс проходит автоматически до конечного результата без ручного участия!
В результате разворачивается одна управляющая нода и неограниченное число воркеров.

### Замечание

По факту каталог app не нужен, запуск приложения происходит c помощью одного файла compose.yaml с помощью 
docker swarm (сам образ приложения лежит в dockerhub kolchinvladimir/app:5.0.0) 

## Подготовка к запуску

1. Подготовить файл myubuntu.json (Операционные системы разворачиваются из подготовленного файла myubuntu.json, через packer.) <br>
Заполнить переменные:
    - TOKEN (IAM token yandex cloud)
    - FOLDER_ID<br>
<br>
Команда получения IAM токена: yc iam create-token<br>
FOLDER_ID: id ресурса в яндекс облаке

2. Подготовить файл terraform/personal.auto.tfvars<br>
    - Переименовать файл personal.auto.tfvars.example в personal.auto.tfvars<br>
   Заполнить переменные: cloud_id и folder_id
   Terraform для подключения к yandex облаку использует файл file("~/.ssh/id_rsa.pub") из файла local.tf
    - Для хранения файла tfstate используется хранилище s3 в yandex облаке (файл providers.tf)

## Запуск проекта:

Из каталога инициализировать terraform <br>
`terraform init`<br>
<br>Запустить проект:<br>
`trerraform apply` 
   
![Снимок экрана от 2025-10-08 18-16-20.png](../../../%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%20%D0%BE%D1%82%202025-10-08%2018-16-20.png)

В результате выполнения команды будут созданы три виртуальные машины (одна из них управляющая нода и два воркера по умолчанию)

![Снимок экрана от 2025-10-08 18-20-38.png](../../../%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%20%D0%BE%D1%82%202025-10-08%2018-20-38.png)

## Результат

Перейдя в браузере по ip адресу управляющей ноды и порту 8090 мы получим следующий ответ:

http://158.160.51.197:8090/

![Снимок экрана от 2025-10-08 18-23-56.png](../../../%D0%98%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%20%D0%BE%D1%82%202025-10-08%2018-23-56.png)



